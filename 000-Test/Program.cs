using System.Net.NetworkInformation;

namespace _000_Test
{
    internal class Program
    {
        static async Task Main()
        {
            string[] ipRanges =
            {
           "85.92.120.117",
"139.28.7.5",
"109.61.122.5",
"92.223.76.27",
"93.123.17.167",
"95.85.92.8",
"90.84.153.35",
"92.223.118.198",
"92.223.118.18",
"190.95.248.34",
"92.223.116.228",
"92.223.124.16",
"79.133.108.15",
"93.123.17.176",
"80.240.124.7",
"92.223.107.53",
"80.15.252.47",
"92.223.114.15",
"45.82.101.6",
"92.223.118.21",
"92.223.124.24",
"151.248.104.69",
"92.223.118.25",
"92.223.12.19",
"79.133.108.4",
"193.242.96.6",
"93.123.17.194",
"92.223.63.11",
"92.223.124.33",
"92.38.170.8",
"185.211.231.187",
"92.223.118.202",
"194.158.198.2",
"92.223.116.213",
"92.223.114.7",
"217.195.193.11",
"79.133.108.29",
"92.223.107.47",
"92.223.64.4",
"80.15.252.43",
"80.240.124.5",
"217.195.193.5",
"213.156.151.6",
"92.223.40.12",
"125.214.171.164",
"92.223.124.32",
"5.8.92.5",
"80.93.215.12",
"92.223.123.51",
"212.232.103.11",
"45.80.213.5",
"5.252.26.4",
"80.15.252.41",
"92.223.74.26",
"78.111.110.5",
"185.101.136.8",
"92.223.63.24",
"185.163.3.5",
"5.1.107.249",
"80.15.228.1",
"92.223.122.186",
"93.115.241.4",
"93.123.11.8",
"93.123.11.9",
"92.223.40.8",
"93.123.17.144",
"92.223.107.39",
"5.188.121.135",
"45.82.101.10",
"103.211.151.21",
"92.223.124.47",
"80.240.113.12",
"193.169.251.8",
"217.195.193.6",
"92.223.76.21",
"94.128.12.238",
"92.223.116.234",
"92.223.40.18",
"92.223.12.25",
"80.93.215.6",
"92.38.159.6",
"92.38.168.6",
"92.38.170.7",
"80.15.235.17",
"194.158.198.5",
"89.223.90.5",
"92.223.118.205",
"213.156.156.4",
"92.223.43.13",
"92.223.78.23",
"93.123.11.12",
"103.178.28.12",
"92.223.118.22",
"95.85.92.7",
"213.156.144.7",
"92.223.40.7",
"80.15.244.5",
"80.15.252.33",
"92.38.168.5",
"92.223.12.22",
"92.223.124.25",
"92.223.107.36",
"193.36.180.11",
"80.15.244.17",
"80.240.124.6",
"93.123.17.148",
"92.223.63.9",
"92.223.40.16",
"80.240.113.9",
"185.101.136.13",
"37.110.209.228",
"80.15.233.3",
"80.15.230.3",
"92.223.118.207",
"79.133.108.25",
"92.223.40.10",
"92.223.107.44",
"31.184.207.9",
"93.123.17.192",
"80.15.232.3",
"185.188.144.7",
"45.82.103.5",
"213.156.151.4",
"5.188.133.10",
"92.223.107.48",
"92.223.63.23",
"92.223.123.45",
"92.223.116.222",
"92.223.116.211",
"92.223.118.4",
"92.223.64.12",
"92.223.124.35",
"92.223.63.26",
"197.148.108.106",
"92.223.118.13",
"79.133.108.27",
"103.178.28.4",
"103.178.28.6",
"92.223.12.16",
"194.44.246.206",
"92.223.116.216",
"5.188.121.182",
"109.61.41.10",
"5.101.219.5",
"92.223.47.6",
"192.16.87.161",
"92.223.76.23",
"92.223.43.14",
"93.123.11.17",
"90.84.153.19",
"92.223.12.20",
"46.49.10.229",
"92.223.124.51",
"93.123.17.191",
"92.223.120.14",
"80.240.113.5",
"90.84.153.226",
"92.223.118.37",
"31.184.207.8",
"92.223.107.51",
"92.223.118.203",
"92.38.159.7",
"185.101.136.12",
"217.195.193.9",
"45.82.100.4",
"80.15.232.1",
"193.169.251.5",
"87.120.164.6",
"185.244.209.6",
"82.213.5.50",
"80.15.246.13",
"92.223.124.18",
"93.123.11.14",
"80.15.243.15",
"92.223.12.4",
"80.15.250.9",
"92.223.76.22",
"92.223.118.40",
"92.223.124.6",
"92.223.55.15",
"193.169.250.9",
"93.123.17.179",
"102.130.69.141",
"93.123.11.16",
"92.223.116.212",
"92.223.63.5",
"125.214.163.193",
"92.223.124.5",
"92.223.110.4",
"194.158.198.6",
"92.223.118.197",
"92.223.47.4",
"92.223.107.56",
"91.149.176.68",
"92.223.40.6",
"90.84.153.131",
"92.223.116.230",
"193.169.251.7",
"193.36.180.12",
"92.223.116.200",
"91.243.83.5",
"93.115.241.5",
"92.223.116.231",
"92.223.124.46",
"45.82.101.9",
"92.38.170.10",
"92.223.123.32",
"79.133.108.31",
"200.24.129.100",
"93.123.17.145",
"92.223.124.17",
"92.223.107.50",
"80.15.252.61",
"5.188.121.165",
"80.15.243.13",
"80.240.113.4",
"5.252.26.8",
"92.223.12.10",
"92.223.63.25",
"90.84.153.130",
"92.223.12.6",
"103.178.28.9",
"5.188.121.138",
"92.223.63.6",
"92.223.118.20",
"93.123.17.178",
"193.169.250.8",
"80.93.215.5",
"62.112.223.4",
"92.223.120.12",
"92.223.55.14",
"41.226.6.202",
"66.84.78.129",
"5.188.94.5",
"92.223.124.54",
"90.84.153.98",
"90.84.153.99",
"213.252.220.4",
"80.15.235.25",
"109.61.122.4",
"93.123.17.183",
"80.240.113.11",
"92.223.55.17",
"92.223.116.233",
"103.178.28.14",
"94.176.183.13",
"185.244.209.8",
"92.223.124.55",
"92.223.122.187",
"90.84.153.17",
"93.123.17.182",
"79.133.108.6",
"217.195.193.13",
"92.223.40.14",
"95.85.92.5",
"92.223.55.18",
"5.101.68.5",
"80.15.252.209",
"80.240.124.8",
"5.252.26.11",
"90.84.153.161",
"46.49.10.231",
"41.210.189.22",
"93.123.11.19",
"80.240.124.10",
"193.169.251.9",
"5.188.121.183",
"185.158.211.186",
"93.123.17.160",
"92.223.61.21",
"202.78.162.4",
"92.223.40.5",
"92.223.118.26",
"160.32.246.129",
"93.123.17.187",
"79.133.108.30",
"185.76.48.122",
"92.223.107.52",
"93.123.17.169",
"62.112.223.5",
"93.123.17.185",
"80.15.252.65",
"92.223.107.54",
"176.222.187.180",
"93.123.17.184",
"92.223.63.28",
"217.76.64.195",
"92.223.63.8",
"92.223.124.31",
"92.223.107.49",
"80.93.221.4",
"5.8.92.6",
"193.169.251.10",
"92.223.123.50",
"92.223.63.22",
"93.123.17.166",
"95.85.69.6",
"92.223.78.22",
"92.223.47.5",
"185.101.136.9",
"92.223.107.38",
"5.101.68.8",
"217.195.193.4",
"93.123.17.189",
"80.15.250.1",
"92.223.123.46",
"79.133.108.13",
"80.15.248.1",
"93.123.17.188",
"93.123.17.193",
"185.188.144.4",
"217.195.193.10",
"80.240.113.8",
"92.223.118.38",
"193.169.251.4",
"87.120.164.5",
"92.223.12.17",
"5.101.222.4",
"92.223.63.4",
"5.188.121.161",
"92.223.124.53",
"5.188.132.6",
"31.184.207.4",
"79.133.108.16",
"92.223.12.7",
"5.188.133.11",
"92.223.118.23",
"5.188.126.7",
"92.223.116.232",
"31.184.207.11",
"45.80.213.8",
"192.16.87.137",
"92.223.12.8",
"92.223.116.225",
"92.223.107.43",
"92.223.123.48",
"94.176.183.14",
"31.184.207.12",
"5.101.220.10",
"179.51.50.82",
"92.223.76.25",
"93.123.17.177",
"31.184.207.7",
"91.185.14.226",
"80.15.231.1",
"193.242.96.4",
"93.123.17.149",
"94.176.183.11",
"80.240.113.21",
"93.123.17.190",
"80.15.246.15",
"80.93.210.4",
"87.120.164.7",
"93.123.17.165",
"45.82.103.8",
"5.188.126.10",
"93.123.11.18",
"5.188.121.162",
"93.123.11.10",
"202.78.162.5",
"78.111.110.4",
"37.239.145.3",
"92.223.118.29",
"92.223.12.15",
"90.84.153.163",
"90.84.153.227",
"87.120.167.42",
"87.120.167.96",
"109.61.16.109",
"95.85.93.31",
"95.85.93.155",
"91.243.81.66",
"94.177.131.57",
"82.117.226.107",
"82.117.226.240",
"82.117.226.126",
"80.15.252.83"
        };

            string resultFile = "result.txt";

            using (StreamWriter writer = new StreamWriter(resultFile, false))
            {
                foreach (string range in ipRanges)
                {
                    string ip = range.Split('/')[0]; // 解析 CIDR 获取 IP 
                    long latency = await PingHost(ip);

                    if (latency >= 0 && latency < 100) // 只记录延迟 < 100ms 的 IP
                    {
                        string result = $"{ip} - {latency}ms";
                        Console.WriteLine(result);
                        await writer.WriteLineAsync(result);
                    }
                    else
                    {
                        Console.WriteLine($"{ip} is unreachable or latency >= 100ms.");
                    }
                }
            }
            Console.WriteLine("Ping 测试完成，结果已写入 result.txt");
        }

        static async Task<long> PingHost(string ipAddress)
        {
            try
            {
                using (Ping ping = new Ping())
                {
                    PingReply reply = await ping.SendPingAsync(ipAddress, 500); // 500ms 超时
                    if (reply.Status == IPStatus.Success)
                    {
                        return reply.RoundtripTime; // 返回延迟（毫秒）
                    }
                }
            }
            catch { }
            return -1; // 失败返回 -1
        }
    }
}
